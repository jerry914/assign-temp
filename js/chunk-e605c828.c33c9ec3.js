(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e605c828"],{"04d1":function(t,e,n){var i=n("342f"),s=i.match(/firefox\/(\d+)/i);t.exports=!!s&&+s[1]},"07ac":function(t,e,n){var i=n("23e7"),s=n("6f53").values;i({target:"Object",stat:!0},{values:function(t){return s(t)}})},"083a":function(t,e,n){"use strict";var i=n("0d51"),s=TypeError;t.exports=function(t,e){if(!delete t[e])throw s("Cannot delete property "+i(e)+" of "+i(t))}},"390f":function(t,e,n){},"4de4":function(t,e,n){"use strict";var i=n("23e7"),s=n("b727").filter,a=n("1dde"),o=a("filter");i({target:"Array",proto:!0,forced:!o},{filter:function(t){return s(this,t,arguments.length>1?arguments[1]:void 0)}})},"4e82":function(t,e,n){"use strict";var i=n("23e7"),s=n("e330"),a=n("59ed"),o=n("7b0b"),r=n("07fa"),c=n("083a"),l=n("577e"),u=n("d039"),b=n("addb"),f=n("a640"),d=n("04d1"),m=n("d998"),g=n("2d00"),h=n("512c"),j=[],O=s(j.sort),p=s(j.push),v=u((function(){j.sort(void 0)})),_=u((function(){j.sort(null)})),k=f("sort"),y=!u((function(){if(g)return g<70;if(!(d&&d>3)){if(m)return!0;if(h)return h<603;var t,e,n,i,s="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)j.push({k:e+i,v:n})}for(j.sort((function(t,e){return e.v-t.v})),i=0;i<j.length;i++)e=j[i].k.charAt(0),s.charAt(s.length-1)!==e&&(s+=e);return"DGBEFHACIJK"!==s}})),C=v||!_||!k||!y,T=function(t){return function(e,n){return void 0===n?-1:void 0===e?1:void 0!==t?+t(e,n)||0:l(e)>l(n)?1:-1}};i({target:"Array",proto:!0,forced:C},{sort:function(t){void 0!==t&&a(t);var e=o(this);if(y)return void 0===t?O(e):O(e,t);var n,i,s=[],l=r(e);for(i=0;i<l;i++)i in e&&p(s,e[i]);b(s,T(t)),n=s.length,i=0;while(i<n)e[i]=s[i++];while(i<l)c(e,i++);return e}})},"512c":function(t,e,n){var i=n("342f"),s=i.match(/AppleWebKit\/(\d+)\./);t.exports=!!s&&+s[1]},"932b":function(t,e,n){},a15b:function(t,e,n){"use strict";var i=n("23e7"),s=n("e330"),a=n("44ad"),o=n("fc6a"),r=n("a640"),c=s([].join),l=a!=Object,u=r("join",",");i({target:"Array",proto:!0,forced:l||!u},{join:function(t){return c(o(this),void 0===t?",":t)}})},a25b:function(t,e,n){"use strict";n("932b")},a434:function(t,e,n){"use strict";var i=n("23e7"),s=n("7b0b"),a=n("23cb"),o=n("5926"),r=n("07fa"),c=n("3511"),l=n("65f0"),u=n("8418"),b=n("083a"),f=n("1dde"),d=f("splice"),m=Math.max,g=Math.min;i({target:"Array",proto:!0,forced:!d},{splice:function(t,e){var n,i,f,d,h,j,O=s(this),p=r(O),v=a(t,p),_=arguments.length;for(0===_?n=i=0:1===_?(n=0,i=p-v):(n=_-2,i=g(m(o(e),0),p-v)),c(p+n-i),f=l(O,i),d=0;d<i;d++)h=v+d,h in O&&u(f,d,O[h]);if(f.length=i,n<i){for(d=v;d<p-i;d++)h=d+i,j=d+n,h in O?O[j]=O[h]:b(O,j);for(d=p;d>p-i+n;d--)b(O,d-1)}else if(n>i)for(d=p-i;d>v;d--)h=d+i-1,j=d+n-1,h in O?O[j]=O[h]:b(O,j);for(d=0;d<n;d++)O[d+v]=arguments[d+2];return O.length=p-i+n,f}})},a74b:function(t,e,n){"use strict";n("390f")},addb:function(t,e,n){var i=n("4dae"),s=Math.floor,a=function(t,e){var n=t.length,c=s(n/2);return n<8?o(t,e):r(t,a(i(t,0,c),e),a(i(t,c),e),e)},o=function(t,e){var n,i,s=t.length,a=1;while(a<s){i=a,n=t[a];while(i&&e(t[i-1],n)>0)t[i]=t[--i];i!==a++&&(t[i]=n)}return t},r=function(t,e,n,i){var s=e.length,a=n.length,o=0,r=0;while(o<s||r<a)t[o+r]=o<s&&r<a?i(e[o],n[r])<=0?e[o++]:n[r++]:o<s?e[o++]:n[r++];return t};t.exports=a},b64b:function(t,e,n){var i=n("23e7"),s=n("7b0b"),a=n("df75"),o=n("d039"),r=o((function(){a(1)}));i({target:"Object",stat:!0,forced:r},{keys:function(t){return a(s(t))}})},d80f:function(t,e,n){"use strict";n.r(e);n("d3b7"),n("fb6a"),n("ac1f"),n("1276");var i=n("7a23"),s=function(t){return Object(i["N"])("data-v-ca18e738"),t=t(),Object(i["L"])(),t},a={class:"page-container"},o={class:"page-title-container"},r={class:"flex-half"},c=s((function(){return Object(i["n"])("div",{class:"page-title"},"尚待派案學生列表",-1)})),l=s((function(){return Object(i["n"])("span",null,"排序方式：",-1)})),u={class:"flex-half",style:{"padding-left":"7px"}},b=s((function(){return Object(i["n"])("span",{class:"page-title"},"初排結果",-1)})),f=s((function(){return Object(i["n"])("strong",null,"操作方式",-1)})),d=s((function(){return Object(i["n"])("div",null,"拖曳左側為派案個案、或是灰色實心方塊調整心理師與時段",-1)})),m=s((function(){return Object(i["n"])("br",null,null,-1)})),g=s((function(){return Object(i["n"])("strong",null,"方塊顏色意義",-1)})),h=s((function(){return Object(i["n"])("div",null,"灰色空格：心理師此時段為有空",-1)})),j=s((function(){return Object(i["n"])("div",null,"灰色實心：初排將此時段配對到一個新的個案",-1)})),O=s((function(){return Object(i["n"])("div",null,"藍色實心：心理師此時段已有排到個案，並且諮商次數為0~6次",-1)})),p=s((function(){return Object(i["n"])("div",null,"紅色實心：心理師此時段已有排到個案，並且諮商次數為7~14次",-1)})),v=s((function(){return Object(i["n"])("div",null,"紫色實心：心理師此時段已有排到個案，並且諮商次數為15次以上",-1)})),_={class:"timetable-info"},k=Object(i["q"])("操作說明"),y={class:"assign-save",style:{padding:"17px 0"}},C=Object(i["q"])("儲存修改"),T=["innerHTML"],w={key:1},D={key:2},L={class:"assign-table",ref:"assignTable"},x=s((function(){return Object(i["n"])("div",{class:"slopeline"},[Object(i["n"])("div",{class:"slope-label slope-label-1"},"姓名"),Object(i["n"])("div",{class:"slope-label slope-label-2"},"時段")],-1)})),I={class:"row-bar assign-header-label",span:2},E=Object(i["q"])("假日"),K={class:"row-bar unavailable",span:2},R=s((function(){return Object(i["n"])("h3",null,"本次新增派案",-1)})),S=Object(i["q"])("下載派案結果"),q=["innerHTML"],$=Object(i["q"])("諮商時段"),A={class:"dialog-footer",slot:"footer",style:{"text-align":"center"}},M=Object(i["q"])("關閉");function X(t,e,n,s,X,B){var H=Object(i["T"])("el-option"),V=Object(i["T"])("el-select"),N=Object(i["T"])("InfoFilled"),P=Object(i["T"])("el-popover"),F=Object(i["T"])("el-button"),U=Object(i["T"])("QuestionFilled"),W=Object(i["T"])("el-col"),z=Object(i["T"])("el-row"),J=Object(i["T"])("el-tooltip"),Y=Object(i["T"])("el-tag"),G=Object(i["T"])("timeBlock"),Q=Object(i["T"])("download-excel"),Z=Object(i["T"])("el-table-column"),tt=Object(i["T"])("el-table"),et=Object(i["T"])("el-dialog"),nt=Object(i["U"])("loading");return Object(i["K"])(),Object(i["m"])("div",a,[Object(i["n"])("div",o,[Object(i["n"])("div",r,[c,Object(i["n"])("div",null,[l,Object(i["r"])(V,{modelValue:X.sortRule,"onUpdate:modelValue":e[0]||(e[0]=function(t){return X.sortRule=t}),placeholder:"請選擇排序方式",onChange:e[1]||(e[1]=function(t){return B.pushSortRule()})},{default:Object(i["ib"])((function(){return[Object(i["r"])(H,{key:"crisis_level",label:"危機程度優先",value:"crisis_level"}),Object(i["r"])(H,{key:"time",label:"初談時間優先",value:"time"})]})),_:1},8,["modelValue"])])]),Object(i["n"])("div",u,[Object(i["n"])("div",null,[b,Object(i["r"])(P,{placement:"bottom",title:"",width:400,trigger:"hover"},{reference:Object(i["ib"])((function(){return[Object(i["n"])("span",_,[k,Object(i["r"])(N,{style:{width:"1em",height:"1em",padding:"0 0 0 3px"}})])]})),default:Object(i["ib"])((function(){return[f,d,m,g,h,j,O,p,v]})),_:1})]),Object(i["n"])("div",y,[Object(i["r"])(F,{size:"large",type:"warning",onClick:e[2]||(e[2]=function(t){return B.submitChange()})},{default:Object(i["ib"])((function(){return[C]})),_:1})])])]),Object(i["jb"])((Object(i["K"])(),Object(i["k"])(z,{gutter:10},{default:Object(i["ib"])((function(){return[Object(i["r"])(W,{sm:24,md:12},{default:Object(i["ib"])((function(){return[Object(i["n"])("div",{class:"drag-table drag-container",onDrop:e[3]||(e[3]=function(){return B.drop&&B.drop.apply(B,arguments)}),onDragover:e[4]||(e[4]=function(){return B.allowDrop&&B.allowDrop.apply(B,arguments)}),ref:"dragBody",id:"dragBody"},[Object(i["r"])(z,{class:"drag-header"},{default:Object(i["ib"])((function(){return[(Object(i["K"])(!0),Object(i["m"])(i["b"],null,Object(i["R"])(X.headerLabel,(function(e){return Object(i["K"])(),Object(i["k"])(W,{class:"drag-header-col",span:4},{default:Object(i["ib"])((function(){return[Object(i["q"])(Object(i["X"])(e),1),"可諮商時段"==e?(Object(i["K"])(),Object(i["k"])(P,{key:0,placement:"right",title:"",width:200,trigger:"hover","popper-class":"weektimePop"},{reference:Object(i["ib"])((function(){return[Object(i["r"])(U,{style:{width:"1em",height:"1em",padding:"0 0 0 3px"}})]})),default:Object(i["ib"])((function(){return[Object(i["n"])("div",{innerHTML:t.getHtmlContent()},null,8,T)]})),_:1})):Object(i["l"])("",!0)]})),_:2},1024)})),256))]})),_:1}),(Object(i["K"])(!0),Object(i["m"])(i["b"],null,Object(i["R"])(X.unassignCases,(function(t){return Object(i["K"])(),Object(i["k"])(z,{draggable:"unassign"==t.status,onDragstart:B.drag,id:"drag-"+t.id,class:Object(i["A"])("unassign"==t.status?"drag-body-row":"undrag-container")},{default:Object(i["ib"])((function(){return[(Object(i["K"])(!0),Object(i["m"])(i["b"],null,Object(i["R"])(X.headerName,(function(e){return Object(i["K"])(),Object(i["k"])(W,{class:"drag-body-col",span:4},{default:Object(i["ib"])((function(){return[t[e].length>10&&"created_date"!=e?(Object(i["K"])(),Object(i["k"])(J,{key:0,content:t[e],effect:"dragBox_tooltip"},{default:Object(i["ib"])((function(){return[Object(i["n"])("div",null,Object(i["X"])(t[e].slice(0,10))+"...",1)]})),_:2},1032,["content"])):"created_date"==e?(Object(i["K"])(),Object(i["m"])("div",w,Object(i["X"])(t[e].split("T")[0]),1)):(Object(i["K"])(),Object(i["m"])("div",D,Object(i["X"])(t[e]),1))]})),_:2},1024)})),256))]})),_:2},1032,["draggable","onDragstart","id","class"])})),256))],544)]})),_:1}),Object(i["r"])(W,{sm:24,md:12},{default:Object(i["ib"])((function(){return[Object(i["n"])("div",L,[Object(i["r"])(z,{class:"assign-header",style:Object(i["B"])("width: "+X.tableWidth+"px")},{default:Object(i["ib"])((function(){return[Object(i["r"])(W,{span:3},{default:Object(i["ib"])((function(){return[x]})),_:1}),Object(i["r"])(W,{class:"assign-col-container",span:21},{default:Object(i["ib"])((function(){return[(Object(i["K"])(!0),Object(i["m"])(i["b"],null,Object(i["R"])(t.times,(function(t){return Object(i["K"])(),Object(i["m"])("div",I,Object(i["X"])(t.label.split("~")[0]),1)})),256))]})),_:1})]})),_:1},8,["style"]),Object(i["r"])(z,{class:"assign-body"},{default:Object(i["ib"])((function(){return[(Object(i["K"])(!0),Object(i["m"])(i["b"],null,Object(i["R"])(X.dayList,(function(n,s){return Object(i["K"])(),Object(i["m"])(i["b"],null,[Object(i["r"])(W,{class:"assign-date",span:24},{default:Object(i["ib"])((function(){return[Object(i["q"])(Object(i["X"])(B.getDatetime(n.offset)),1),X.timetable[n.offset].isHoliday?(Object(i["K"])(),Object(i["k"])(Y,{key:0,class:"mx-1",type:"danger",size:"mini",effect:"dark",round:""},{default:Object(i["ib"])((function(){return[E]})),_:1})):Object(i["l"])("",!0)]})),_:2},1024),(Object(i["K"])(!0),Object(i["m"])(i["b"],null,Object(i["R"])(X.timetable[n.offset].rows,(function(s,a){return Object(i["K"])(),Object(i["m"])(i["b"],null,[X.timetable[n.offset].isHoliday?Object(i["l"])("",!0):(Object(i["K"])(),Object(i["m"])(i["b"],{key:0},[Object(i["r"])(W,{class:"assign-aside-label col-bar",span:3},{default:Object(i["ib"])((function(){return[Object(i["q"])(Object(i["X"])(s.counselor_name),1)]})),_:2},1024),Object(i["r"])(W,{class:"assign-col-container col-bar",span:21},{default:Object(i["ib"])((function(){return[(Object(i["K"])(!0),Object(i["m"])(i["b"],null,Object(i["R"])(t.times,(function(o){return Object(i["K"])(),Object(i["m"])("div",K,[s.block[o.value]?(Object(i["K"])(),Object(i["k"])(G,{key:0,class:"drag-container",block:s.block[o.value],pos:n.offset+"-"+a+"-"+o.value,onAddTimeblock:function(t){return B.addTimeblock(t,n.offset,a,o.value)},onRemoveTimeblock:B.removeTimeblock,onSetDragPos:B.setDragPos,onEndCase:e[5]||(e[5]=function(e){return B.endCase(e,t.data)}),onReturnCase:e[6]||(e[6]=function(e){return B.returnCase(e,t.data)})},null,8,["block","pos","onAddTimeblock","onRemoveTimeblock","onSetDragPos"])):Object(i["l"])("",!0)])})),256))]})),_:2},1024)],64))],64)})),256))],64)})),256))]})),_:1})],512)]})),_:1})]})),_:1})),[[nt,X.loading]]),Object(i["r"])(et,{title:"儲存成功",modelValue:X.dialogVisible,"onUpdate:modelValue":e[8]||(e[8]=function(t){return X.dialogVisible=t}),width:"60%",onClose:B.handleClose,center:""},{default:Object(i["ib"])((function(){return[Object(i["r"])(z,null,{default:Object(i["ib"])((function(){return[Object(i["r"])(W,{span:12},{default:Object(i["ib"])((function(){return[R]})),_:1}),Object(i["r"])(W,{span:12},{default:Object(i["ib"])((function(){return[Object(i["r"])(Q,{data:B.downloadXLS(),fields:X.json_fields,name:B.getDateStr(0)+"新增派案.xls"},{default:Object(i["ib"])((function(){return[Object(i["r"])(F,{type:"success",size:"medium",style:{float:"right","margin-right":"40px"}},{default:Object(i["ib"])((function(){return[S]})),_:1})]})),_:1},8,["data","fields","name"])]})),_:1})]})),_:1}),Object(i["r"])(tt,{data:B.assigningCases,style:{width:"100%"}},{default:Object(i["ib"])((function(){return[Object(i["r"])(Z,{prop:"name",label:"姓名"}),Object(i["r"])(Z,{prop:"caseId",label:"學號"}),Object(i["r"])(Z,{label:"諮商時段"},{header:Object(i["ib"])((function(){return[Object(i["r"])(P,{placement:"right",title:"",width:200,trigger:"hover","popper-class":"weektimePop"},{reference:Object(i["ib"])((function(){return[Object(i["n"])("span",null,[$,Object(i["r"])(U,{style:{width:"1em",height:"1em",padding:"0 0 0 3px"}})])]})),default:Object(i["ib"])((function(){return[Object(i["n"])("div",{innerHTML:t.getHtmlContent()},null,8,q)]})),_:1})]})),default:Object(i["ib"])((function(t){return[Object(i["n"])("div",null,Object(i["X"])(t.row.consultation_day+t.row.consultation_time),1)]})),_:1}),Object(i["r"])(Z,{prop:"counselor_name",label:"派案老師"}),Object(i["r"])(Z,{prop:"first_consultation_date",label:"諮商開始時間"}),Object(i["r"])(Z,{prop:"crisis_level",label:"危機程度"}),Object(i["r"])(Z,{prop:"init_counselor_name",label:"初談老師"}),Object(i["r"])(Z,{prop:"discription",label:"狀態說明"}),Object(i["r"])(Z,{prop:"created_date",label:"初談時間"},{default:Object(i["ib"])((function(t){return[Object(i["n"])("div",null,Object(i["X"])(t.row.created_date.split("T")[0]),1)]})),_:1})]})),_:1},8,["data"]),Object(i["n"])("div",A,[Object(i["r"])(F,{type:"danger",onClick:e[7]||(e[7]=function(t){return X.dialogVisible=!1})},{default:Object(i["ib"])((function(){return[M]})),_:1})])]})),_:1},8,["modelValue","onClose"])])}var B=n("c7eb"),H=n("1da1"),V=(n("4de4"),n("159b"),n("4e82"),n("b0c0"),n("99af"),n("a15b"),n("a434"),n("07ac"),n("b64b"),n("7db0"),function(t){return Object(i["N"])("data-v-3a3342a2"),t=t(),Object(i["L"])(),t}),N={key:0,class:"block-container unassign",ref:"blockContainer"},P={key:1},F=["innerHTML"],U=["draggable","id"],W=V((function(){return Object(i["n"])("br",null,null,-1)})),z=["innerHTML"],J={style:{display:"flex","justify-content":"center"}},Y=Object(i["q"])("取消派案"),G={class:"assign-block"},Q=V((function(){return Object(i["n"])("br",null,null,-1)}));function Z(t,e,n,s,a,o){var r=this,c=Object(i["T"])("el-popover"),l=Object(i["T"])("el-button");return Object(i["K"])(),Object(i["m"])("div",null,["unassign"==n.block?(Object(i["K"])(),Object(i["m"])("div",N,[Object(i["n"])("div",{class:"unassign-block droggable-block",onDrop:e[0]||(e[0]=function(){return o.drop&&o.drop.apply(o,arguments)}),onDragover:e[1]||(e[1]=function(){return o.allowDrop&&o.allowDrop.apply(o,arguments)})},"未指派",32)],512)):"assigning"==n.block.status?(Object(i["K"])(),Object(i["m"])("div",P,[Object(i["r"])(c,{placement:n.block.consultation_time>=7?"left":"right",title:n.block.name,width:200,trigger:"click","hide-after":0,disabled:"unassign"==n.block},{reference:Object(i["ib"])((function(){return[Object(i["n"])("div",{class:Object(i["A"])(["block-container draggable-block assign-block",o.getColor()]),onClick:e[3]||(e[3]=function(t){return n.block.isLater?o.clikeLaterBlock():""})},[Object(i["n"])("div",{draggable:!n.block.isLater,onDragstart:e[2]||(e[2]=function(){return o.drag&&o.drag.apply(o,arguments)}),id:"drag-"+n.block.id},[Object(i["q"])(Object(i["X"])(n.block.name)+" ",1),W,Object(i["q"])(" （"+Object(i["X"])(n.block.consultation_number)+"）",1)],40,U)],2)]})),default:Object(i["ib"])((function(){return[Object(i["n"])("div",{innerHTML:o.formatContent()},null,8,F)]})),_:1},8,["placement","title","disabled"])])):(Object(i["K"])(),Object(i["m"])("div",{key:2,class:Object(i["A"])(["block-container",o.getColor()])},[Object(i["r"])(c,{placement:n.block.consultation_time>=7?"left":"right",title:n.block.name,width:200,trigger:"click","hide-after":0,disabled:"unassign"==n.block},{reference:Object(i["ib"])((function(){return[Object(i["n"])("div",G,[Object(i["q"])(Object(i["X"])(n.block.name)+" ",1),Q,Object(i["q"])(" （"+Object(i["X"])(n.block.consultation_number)+"）",1)])]})),default:Object(i["ib"])((function(){return[Object(i["n"])("div",{innerHTML:o.formatContent()},null,8,z),Object(i["n"])("div",J,[Object(i["r"])(l,{type:"warning",size:"small",style:{margin:"5px 10px"},onClick:e[4]||(e[4]=function(t){return r.$emit("returnCase",n.block)})},{default:Object(i["ib"])((function(){return[Y]})),_:1}),Object(i["r"])(l,{type:"danger",size:"small",style:{margin:"5px 10px"},onClick:e[5]||(e[5]=function(t){return o.clickEnd()}),disabled:"closed"==n.block.status},{default:Object(i["ib"])((function(){return[Object(i["q"])(Object(i["X"])("closed"==n.block.status?"已結案":"結案"),1)]})),_:1},8,["disabled"])])]})),_:1},8,["placement","title","disabled"])],2))])}var tt={props:["block","pos"],data:function(){return{}},methods:{getColor:function(){return"closed"==this.block.status?"black-block":"reserve"==this.block.status?"aliceblue-block":"assign"!=this.block.status?this.block.isLater?"darker-gray-block":"gray-block":this.block.consultation_number>=15?"purple-block":this.block.consultation_number>=7?"red-block":this.block.consultation_number>=1?"blue-block":void 0},formatContent:function(){return"\n            學號：".concat(this.block.caseId," <br>\n            初談時間：").concat(this.block.created_date.split("T")[0],"<br>\n            危機程度：").concat(this.block.crisis_level," <br>\n            狀況說明：").concat(this.block.discription," <br>\n            諮商時段：").concat(this.block.consultation_day+this.block.consultation_time," <br>\n            諮商次數：").concat(this.block.consultation_number,"<br>\n            開始諮商：").concat(this.getDateStr(this.block.first_consultation_date),"<br>\n            ").concat("closed"==this.block.status?"結束諮商："+this.getDateStr(this.block.end_consultation_date):"","\n            ")},allowDrop:function(t){t.preventDefault()},drag:function(t){t.dataTransfer.setData("text",t.target.id),this.$emit("setDragPos",this.pos)},drop:function(t){t.preventDefault();var e=t.dataTransfer.getData("text");t.target.classList.contains("drag-container")?t.target.appendChild(document.getElementById(e)):t.target.classList.contains("unassign-block")?(this.$emit("removeTimeblock",{id:e.split("-")[1]}),this.$emit("addTimeblock",e.split("-")[1])):document.querySelector("#dragBody").appendChild(document.getElementById(e))},getDateStr:function(t){var e=new Date(t);return e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()},clikeLaterBlock:function(){this.$message({showClose:!0,message:"請移動一週前此時段的區塊來調整時間",duration:5e3})},clickEnd:function(){var t=this.block;t.offset=parseInt(this.pos.split("-")[0]),this.$emit("endCase",t)}}},et=(n("a74b"),n("d959")),nt=n.n(et);const it=nt()(tt,[["render",Z],["__scopeId","data-v-3a3342a2"]]);var st=it,at=n("b3e6"),ot=n("2ef0"),rt=n.n(ot),ct={mixins:[at["a"]],components:{timeBlock:st},inject:["reload"],data:function(){return{dialogVisible:!1,headerLabel:["學號","姓名","可諮商時段","危機程度","狀態說明","初談時間"],headerName:["caseId","name","available_time","crisis_level","discription","created_date"],assignCases:[],unassignCases:[],counselors:[],timetable:{},tableWidth:0,dragPos:"",dayList:[],emptyTimeList:[],finalTimeInfo:[],loading:!0,json_fields:{"姓名":"name","學號":"caseId","諮商時段":"consultation_datetime","派案老師":"counselor_name","諮商開始時間":"first_consultation_date","危機程度":"crisis_level","初談老師":"init_counselor_name","狀態說明":"discription","初談時間":"created_date"},sortRule:"sortRule",sortScore:{crisis_level:{labelNumber:{A:1e3,B:100,C:0},levelNumber:{"+":0,"-":0}},time:{labelNumber:{A:0,B:0,C:0},levelNumber:{"+":0,"-":0}}}}},created:function(){var t=this;return Object(H["a"])(Object(B["a"])().mark((function e(){return Object(B["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.sortRule=t.$route.query.sort_rule?t.$route.query.sort_rule:"crisis_level",e.next=3,t.$store.dispatch("fetchAssignCases");case 3:return e.next=5,t.$store.dispatch("fetchCounselors");case 5:return e.next=7,t.$store.dispatch("fetchUnassignCases");case 7:t.timetable=t.createTimeTable(),console.log(t.timetable);case 9:case"end":return e.stop()}}),e)})))()},computed:{assigningCases:function(){return this.unassignCases.filter((function(t){return"assigning"==t.status}))}},mounted:function(){var t=this.$refs.assignTable.clientWidth;this.tableWidth=t},methods:{pushSortRule:function(){this.$router.push({path:"",query:{sort_rule:this.sortRule}}),this.reload()},sortCases:function(t){var e=new Date,n=864e5;this.sortRule=this.$route.query.sort_rule?this.$route.query.sort_rule:"crisis_level";var i=this.sortScore[this.sortRule]["labelNumber"],s=this.sortScore[this.sortRule]["levelNumber"];t.forEach((function(t){var a=0;for(var o in i)t.crisis_level.indexOf(o)>=0&&(a+=i[o]);for(var r in s)t.crisis_level.indexOf(r)>=0&&(a+=s[r]);t.score=a;var c=new Date(t.created_date),l=Math.ceil(Math.abs(e-c)/n);t.score+=l})),t.sort((function(t,e){return t.score>e.score?-1:t.score<e.score?1:0}))},createTimeTable:function(){var t=this;this.unassignCases=rt.a.cloneDeep(this.$store.state.unassignCases),this.sortCases(this.unassignCases),this.assignCases=rt.a.cloneDeep(this.$store.state.assignCases.data),this.counselors=this.$store.state.counselors;for(var e={},n=function(n){s=["U","M","T","W","R","F","S"],a=new Date,a.setDate(a.getDate()+n);var i=s[a.getDay()];if("U"!=i&&"S"!=i){var r=t.checkHoliday(a);t.dayList.push({name:i,offset:n}),o={},t.counselors.forEach((function(e){if(e.available_time.indexOf(i)>=0){for(var s=e.available_time.split(","),a={},c=0;c<s.length;c++)if(s[c].indexOf(i)>=0){var l=s[c].substr(s[c].length-1);a[l]="unassign",r||t.emptyTimeList.unshift("".concat(i).concat(l,"-").concat(n,"-").concat(e.name))}o[e.name]={counselor_name:e.name,block:a}}})),e[n]={offset:n,rows:o,isHoliday:!!r}}},i=8;i>=0;i--){var s,a,o;n(i)}if(this.assignCases&&this.assignCases.forEach((function(n){var i=t.dayList.filter((function(t){return t.name==n.consultation_day}));i.forEach((function(i){if(e[i.offset].rows[n.counselor_name]||(e[i.offset].rows[n.counselor_name]={block:{}}),t.checkRangeDay(i.offset,n.end_consultation_date,n.first_consultation_date,n.status)){var s=rt.a.cloneDeep(n);e[i.offset].rows[n.counselor_name].block[n.consultation_time]=s,e[i.offset].rows[n.counselor_name].block[n.consultation_time].consultation_number=t.countConsultationNumber(t.getDateStr(i.offset),s.first_consultation_date),t.emptyTimeList=t.removeEmptyTimeList(t.emptyTimeList,i.name,s.consultation_time,i.offset,s.counselor_name)}else if(t.checkReserve(i.offset,n.first_consultation_date)){var a=rt.a.cloneDeep(n);e[i.offset].rows[n.counselor_name].block[n.consultation_time]=a,e[i.offset].rows[n.counselor_name].block[n.consultation_time].consultation_number=0,e[i.offset].rows[n.counselor_name].block[n.consultation_time].status="reserve",t.emptyTimeList=t.removeEmptyTimeList(t.emptyTimeList,i.name,a.consultation_time,i.offset,a.counselor_name)}}))})),this.emptyTimeList=this.clearRepeatTime(rt.a.cloneDeep(this.emptyTimeList)),this.unassignCases.length>0){var r={timeInfo:"",fit_time:this.fitEmptyTimeList(this.unassignCases[0].available_time,this.emptyTimeList),remain_time:this.emptyTimeList};this.makeTree(r,0);var c=0;while(this.finalTimeInfo.length>0)"unassign"==this.finalTimeInfo[0]||"undefined"==this.finalTimeInfo[0]?this.finalTimeInfo.shift():function(){var n=t.finalTimeInfo[0].charAt(0),i=t.finalTimeInfo[0].charAt(1),s=t.finalTimeInfo[0].split("-")[1],a=t.finalTimeInfo[0].split("-")[2];if(t.unassignCases[c].status="assigning",t.unassignCases[c].consultation_day=n,t.unassignCases[c].consultation_time=i,t.unassignCases[c].counselor_name=a,t.unassignCases[c].counselor_id=t.counselors.filter((function(t){return t.name==a}))[0].id,t.unassignCases[c].first_consultation_date=t.getDateStr(s),t.unassignCases[c].consultation_number=0,e[s].rows[a].block[i]=rt.a.cloneDeep(t.unassignCases[c]),s<2){var o=parseInt(s)+7;e[o].rows[a].block[i]=rt.a.cloneDeep(t.unassignCases[c]),e[o].rows[a].block[i].consultation_number=1,e[o].rows[a].block[i].isLater=!0}t.finalTimeInfo.shift()}(),c+=1}return setTimeout((function(){t.loading=!1}),"1000"),e},makeTree:function(t,e){var n=this;if(this.unassignCases[e+1])if(t.fit_time.length>0){var i=0;if(t.fit_time.forEach((function(s){var a=n.fitEmptyTimeList(n.unassignCases[e+1].available_time,n.removeEmptyTimeList(t.remain_time,0,0,0,0,s));if(a.length>i){i=a.length;var o={timeInfo:t.timeInfo+s+",",remain_time:n.removeEmptyTimeList(t.remain_time,0,0,0,0,s),fit_time:a};n.makeTree(o,e+1)}})),0==i){var s=t.fit_time[0],a={timeInfo:t.timeInfo+s+",",remain_time:this.removeEmptyTimeList(t.remain_time,0,0,0,0,s),fit_time:this.fitEmptyTimeList(this.unassignCases[e+1].available_time,this.removeEmptyTimeList(t.remain_time,0,0,0,0,s))};this.makeTree(a,e+1)}}else{var o={timeInfo:t.timeInfo+"unassign,",remain_time:t.remain_time,fit_time:this.fitEmptyTimeList(this.unassignCases[e+1].available_time,t.remain_time)};this.makeTree(o,e+1)}else{var r=t.timeInfo+t.fit_time[0];this.finalTimeInfo=r.split(",")}},fitEmptyTimeList:function(t,e){return e.filter((function(e){return t.indexOf(e.split("-")[0])>=0}))},clearRepeatTime:function(t){return t.forEach((function(e){var n=e.split("-");n[1]=parseInt(n[1])+7;var i=t.indexOf(n.join("-"));i>=0&&t.splice(i,1)})),t},removeEmptyTimeList:function(t,e,n,i,s){var a,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=[],c=-1;while(++c<t.length)r[c]=t[c];return a=o?r.indexOf(o):r.indexOf("".concat(e).concat(n,"-").concat(i,"-").concat(s)),a>-1&&r.splice(a,1),Object.values(r)},getDateStr:function(t){var e=new Date;return e.setDate(e.getDate()+parseInt(t)),e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()},getDatetime:function(t){var e=["（日）","（ㄧ）","（二）","（三）","（四）","（五）","（六）"],n=new Date;n.setDate(n.getDate()+parseInt(t));var i=n.getFullYear()+" / "+(n.getMonth()+1)+" / "+n.getDate()+"  "+e[n.getDay()];return i},allowDrop:function(t){t.preventDefault()},drag:function(t){t.dataTransfer.setData("text",t.target.id)},drop:function(t){t.preventDefault();var e=t.dataTransfer.getData("text");t.target.classList.contains("unassign-block")?t.target.appendChild(document.getElementById(e)):this.removeTimeblock({id:e.split("-")[1],dis:"table"})},setDragPos:function(t){this.dragPos=t},removeTimeblock:function(t){var e=this,n=t.id,i=t.dis;if("table"==i)Object.keys(this.timetable).forEach((function(t){Object.keys(e.timetable[t].rows).forEach((function(i){Object.keys(e.timetable[t].rows[i].block).forEach((function(s){e.timetable[t].rows[i].block[s].id==n&&(e.changeCaseStatus(n,"unassign"),e.timetable[t].rows[i].block[s]="unassign")}))}))}));else if(""!=this.dragPos){var s=this.dragPos.split("-");this.timetable[parseInt(s[0])+7]&&(this.timetable[parseInt(s[0])+7].rows[s[1]].block[s[2]]="unassign"),this.timetable[s[0]].rows[s[1]].block[s[2]]="unassign"}},addTimeblock:function(t,e,n,i){for(var s=this.dayList.find((function(t){return t.offset==e})),a=0;a<this.unassignCases.length;a++)if(this.unassignCases[a].id==t)return this.timetable[e].rows[n].block[i]=this.unassignCases[a],this.unassignCases[a].status="assigning",this.unassignCases[a].counselor_name=n,this.unassignCases[a].counselor_id=this.counselors.filter((function(t){return t.name==n}))[0].id,this.unassignCases[a].consultation_day=s.name,this.unassignCases[a].consultation_time=i,this.unassignCases[a].first_consultation_date=this.getDateStr(e),void(this.timetable[e+7]&&("unassign"!=this.timetable[e+7].rows[n].block[i]&&this.changeCaseStatus(this.timetable[e+7].rows[n].block[i].id,"unassign"),this.timetable[e+7].rows[n].block[i]=rt.a.cloneDeep(this.unassignCases[a]),this.timetable[e+7].rows[n].block[i].consultation_number=1,this.timetable[e+7].rows[n].block[i].isLater=!0))},changeCaseStatus:function(t,e){var n=this.unassignCases.find((function(e){return e.id==t}));n&&(n.status=e,console.log(this.unassignCases))},putCase:function(t,e){var n={};n="closed"==e.status?{status:e.status,end_consultation_date:e.end_consultation_date}:"unassign"==e.status?{status:e.status}:{status:e.status,consultation_day:e.consultation_day,consultation_time:e.consultation_time,counselor_id:e.counselor_id,counselor_name:e.counselor_name,first_consultation_date:e.first_consultation_date},this.$http.put("/api/cases/"+t,n).then((function(t){console.log(t.data.message)})).catch((function(t){console.log(t)}))},submitChange:function(){for(var t=rt.a.cloneDeep(this.assigningCases),e=0;e<this.assigningCases.length;e++)t[e].status="assign",this.putCase(t[e].id,t[e]);this.dialogVisible=!0},downloadXLS:function(){for(var t=this,e=rt.a.cloneDeep(this.assigningCases),n=function(n){e[n].consultation_datetime="星期"+t.days.find((function(t){return t.value==e[n].consultation_day})).label+" "+t.times.find((function(t){return t.value==e[n].consultation_time})).label,e[n].created_date=e[n].created_date.split("T")[0]},i=0;i<e.length;i++)n(i);return e},downloadCSV:function(){for(var t=this,e=[["姓名","學號","諮商時段","派案老師","諮商開始時間","危機程度","初談老師","狀態說明","初談時間"]],n=rt.a.cloneDeep(this.assigningCases),i=function(i){e.push([n[i].name,n[i].caseId,"星期"+t.days.find((function(t){return t.value==n[i].consultation_day})).label+" "+t.times.find((function(t){return t.value==n[i].consultation_time})).label,n[i].counselor_name,n[i].first_consultation_date,n[i].crisis_level,n[i].init_counselor_name,n[i].discription,n[i].created_date])},s=0;s<n.length;s++)i(s);var a="data:text/csv;charset=utf-8,";e.forEach((function(t){var e=t.join(",");a+=e+"\r\n"}));var o=encodeURI(a);window.open(o)},handleClose:function(){for(var t=this,e=rt.a.cloneDeep(this.assigningCases),n=function(n){Object.keys(t.timetable).forEach((function(i){Object.keys(t.timetable[i].rows).forEach((function(s){Object.keys(t.timetable[i].rows[s].block).forEach((function(a){t.timetable[i].rows[s].block[a].id==e[n].id&&(t.timetable[i].rows[s].block[a].status="assign",t.timetable[i].rows[s].block[a].consultation_number=1)}))}))}))},i=0;i<e.length;i++)n(i);this.unassignCases=this.unassignCases.filter((function(t){return"unassign"==t.status}))},endCase:function(t){var e=t;e.status="closed",e.end_consultation_date=this.getDateStr(e.offset),this.putCase(e.id,e),this.removeTimeblock({id:t.id})},returnCase:function(t){var e=t;e.status="unassign",e.consultation_number=0,this.putCase(e.id,e),this.removeTimeblock({id:t.id,dis:"table"}),this.unassignCases.push(t)}}};n("a25b");const lt=nt()(ct,[["render",X],["__scopeId","data-v-ca18e738"]]);e["default"]=lt},d998:function(t,e,n){var i=n("342f");t.exports=/MSIE|Trident/.test(i)}}]);
//# sourceMappingURL=chunk-e605c828.c33c9ec3.js.map